@using ChatApp.Services.ChatBot;
@using ChatApp.Services.ChatBot.Model;

@page "/chat"
@inject IChatBot chatBot

<PageTitle>Chat</PageTitle>

<p>
    <textarea rows="3" cols="60" name="prompt" @bind="@prompt" placeholder="Your prompt..."></textarea>
</p>

<p>
    <button class="btn btn-primary" @onclick="SendPrompt">Send</button>
</p>

<p>
    <textarea rows="5" cols="60" name="response" @bind="@response" placeholder="The response..."></textarea>
</p>

<p>
    <textarea rows="15" cols="60" name="history" @bind="@history" placeholder="The history..."></textarea>
</p>


@code {
    string prompt = "What is my name and what is my age?";
    string response = string.Empty;
    string history = string.Empty;

    protected override Task OnInitializedAsync()
    {
        chatBot.AnswerReceived += OnAnswerReceived;
        return base.OnInitializedAsync();
    }

    Task OnAnswerReceived(object sender, ChatInteraction interaction)
    {
        response = interaction.Answer;
        history = string.Join("\n", chatBot.GetHistory(3).Select(h => h.ToString()));

        return Task.CompletedTask;
    }

    async Task SendPrompt()
    {        
        await chatBot.Send(prompt);
    }
}
